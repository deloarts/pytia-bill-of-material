<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pytia_bill_of_material.worker.export_items API documentation</title>
<meta name="description" content="Exports all items selected by the user. Dockets, STP, STL, ..." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pytia_bill_of_material.worker.export_items</code></h1>
</header>
<section id="section-intro">
<p>Exports all items selected by the user. Dockets, STP, STL, &hellip;</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
    Exports all items selected by the user. Dockets, STP, STL, ...
&#34;&#34;&#34;

from pathlib import Path
from typing import Annotated
from typing import Dict

from const import DOCKETS
from const import DOCUMENTATION
from const import DRAWINGS
from const import JPGS
from const import LOGON
from const import STLS
from const import STPS
from const import TEMP_EXPORT
from helper.lazy_loaders import LazyDocumentHelper
from helper.names import get_data_export_name
from models.bom import BOM
from models.bom import BOMAssemblyItem
from protocols.task_protocol import TaskProtocol
from pytia.exceptions import PytiaWrongDocumentTypeError
from pytia.log import log
from pytia.utilities.docket import DocketConfig
from pytia.wrapper.documents.part_documents import PyPartDocument
from pytia.wrapper.documents.product_documents import PyProductDocument
from pytia_ui_tools.handlers.workspace_handler import Workspace
from pytia_ui_tools.utils.files import file_utility
from pytia_ui_tools.utils.qr import QR
from resources import resource
from templates import templates
from utils import export

from .runner import Runner

PartnumberString = Annotated[str, lambda s: str(s)]


class ExportItemsTask(TaskProtocol):
    &#34;&#34;&#34;
    Exports all items:
    - Dockets
    - Docu Dockets
    - Drawings
    - STP
    - STL

    Args:
        TaskProtocol (_type_): The protocol for the task runner.

    Raises:
        Exception: Raised when the keyword for &#39;source&#39; is not in the BOM.
        PytiaWrongDocumentTypeError: Raised when the document is neither a part nor a product.

    Returns:
        _type_: _description_
    &#34;&#34;&#34;

    def __init__(
        self,
        lazy_loader: LazyDocumentHelper,
        runner: Runner,
        bom: BOM,
        export_docket: bool,
        export_documentation: bool,
        export_drawing: bool,
        export_stp: bool,
        export_stl: bool,
        export_jpg: bool,
        export_root_path: Path,
        docket_config: DocketConfig,
        documentation_config: DocketConfig,
        workspace: Workspace,
    ) -&gt; None:
        &#34;&#34;&#34;
        Inits the class.

        Args:
            lazy_loader (LazyDocumentHelper): The doc helper instance.
            runner (Runner): The task runner instance.
            bom (BOM): The BOM object.
            export_docket (bool): Wether to export the docket or not.
            export_documentation (bool): Wether to export the docu docket or not.
            export_drawing (bool): Wether to export the drawing or not.
            export_stp (bool): Wether to export the stp or not.
            export_stl (bool): Wether to export the stl or not.
            export_jpg (bool): Wether to export the jpg or not.
            export_root_path (Path): The root folder for all exports.
            docket_config (DocketConfig): The configuration for the docket.
            documentation_config (DocketConfig): The configuration for the docu docket.
        &#34;&#34;&#34;
        self.lazy_loader = lazy_loader
        self.runner = runner
        self.bom = bom
        self.export_docket = export_docket
        self.export_documentation = export_documentation
        self.export_drawing = export_drawing
        self.export_stp = export_stp
        self.export_stl = export_stl
        self.export_jpg = export_jpg
        self.export_root_path = export_root_path
        self.docket_config = docket_config
        self.documentation_config = documentation_config
        self.workspace = workspace

    def run(self) -&gt; None:
        &#34;&#34;&#34;
        Runs the task.

        Raises:
            Exception: Raised when the keyword for &#39;source&#39; is not in the BOM.
        &#34;&#34;&#34;
        log.info(&#34;Exporting selected items.&#34;)
        if any(
            [
                self.export_docket,
                self.export_documentation,
                self.export_stp,
                self.export_stl,
                self.export_drawing,
                self.export_jpg,
            ]
        ):
            self.lazy_loader.close_all_documents()
            complete_items: Dict[PartnumberString, BOMAssemblyItem] = {}

            # The following &#39;solution&#39; is required to export all assemblies,
            # even those that don&#39;t show in the summary of the CATIA BOM.
            # It&#39;s not possible to only use all items of the bom.assemblies
            # object, because this would result in false quantities.
            # Therefor it&#39;s a must to compare those list object with great
            # care.
            for summary_item in self.bom.summary.items:
                complete_items[summary_item.partnumber] = summary_item

                for assembly in self.bom.assemblies:
                    for assembly_item in assembly.items:
                        if not assembly_item.partnumber in complete_items:
                            complete_items[assembly_item.partnumber] = assembly_item

            for partnumber, item in complete_items.items():
                if not resource.applied_keywords.source in item.properties:
                    raise Exception(
                        f&#34;Keyword {resource.applied_keywords.source!r} not in bill of material.&#34;
                    )
                if (
                    item.properties[resource.applied_keywords.source]
                    == resource.applied_keywords.made
                ):
                    self.runner.add(
                        func=self._export_item,
                        name=f&#34;Export item {partnumber!r}&#34;,
                        bom_item=item,
                    )

            self.runner.run_tasks()
            log.info(&#34;Finished item export.&#34;)
        else:
            log.info(&#34;Skipping item export: None selected.&#34;)

    def _generate_qr(self, bom_item: BOMAssemblyItem) -&gt; Path:
        &#34;&#34;&#34;
        Generates a qr jpg file and saves it to the temp directory. Returns the path.
        The QR ode contains a serialized json of: project, machine, partnumber and revision.

        Args:
            bom_item (BOMAssemblyItem): An item of the BOM object, from which data to generate the \
                qr code.

        Returns:
            Path: The path to the generated jpg file.
        &#34;&#34;&#34;
        project = bom_item.properties[resource.bom.required_header_items.project]
        machine = bom_item.properties[resource.bom.required_header_items.machine]
        partnumber = bom_item.properties[resource.bom.required_header_items.partnumber]
        revision = bom_item.properties[resource.bom.required_header_items.revision]

        qr = QR()
        qr_data = {
            &#34;project&#34;: project,
            &#34;machine&#34;: machine,
            &#34;partnumber&#34;: partnumber,
            &#34;revision&#34;: revision,
        }
        qr.generate(data=qr_data)
        qr_path = qr.save(
            path=Path(
                TEMP_EXPORT,
                self.export_root_path,
                file_utility.get_random_filename(filetype=&#34;png&#34;),
            )
        )
        file_utility.add_delete(path=qr_path, skip_silent=True)
        return qr_path

    def _export_item(self, bom_item: BOMAssemblyItem) -&gt; None:
        &#34;&#34;&#34;
        Exports the BOM item.

        TODO: Refactor this into smaller bits.

        Args:
            bom_item (BOMAssemblyItem): An item of the BOM object.

        Raises:
            PytiaWrongDocumentTypeError: Raised when the BOM item is neither a part nor a product.
        &#34;&#34;&#34;
        if bom_item.path is None:
            log.warning(
                f&#34;Skipped export of item {bom_item.partnumber!r}: Path of item not found.&#34;
            )
            return

        log.info(f&#34;Exporting data of item {bom_item.partnumber!r}.&#34;)
        export_filename = get_data_export_name(bom_item, with_project=False)
        export_filename_with_project = get_data_export_name(bom_item, with_project=True)
        qr_path = self._generate_qr(bom_item=bom_item)

        if &#34;.CATPart&#34; in str(bom_item.path):
            with PyPartDocument() as part_document:
                part_document.open(bom_item.path)

                if self.export_docket:
                    export.export_docket(
                        docket_template=templates.docket_path,
                        filename=export_filename_with_project,
                        folder=Path(self.export_root_path, DOCKETS),
                        document=part_document,
                        config=self.docket_config,
                        project=bom_item.properties[
                            resource.bom.required_header_items.project
                        ],
                        machine=bom_item.properties[
                            resource.bom.required_header_items.machine
                        ],
                        partnumber=bom_item.properties[
                            resource.bom.required_header_items.partnumber
                        ],
                        revision=bom_item.properties[
                            resource.bom.required_header_items.revision
                        ],
                        quantity=bom_item.properties[
                            resource.bom.required_header_items.quantity
                        ],
                        qr_path=qr_path,
                    )
                if self.export_documentation:
                    export.export_docket(
                        docket_template=templates.documentation_path,
                        filename=export_filename,
                        folder=Path(self.export_root_path, DOCUMENTATION),
                        document=part_document,
                        config=self.documentation_config,
                        project=bom_item.properties[
                            resource.bom.required_header_items.project
                        ],
                        machine=bom_item.properties[
                            resource.bom.required_header_items.machine
                        ],
                        partnumber=bom_item.properties[
                            resource.bom.required_header_items.partnumber
                        ],
                        revision=bom_item.properties[
                            resource.bom.required_header_items.revision
                        ],
                        quantity=bom_item.properties[
                            resource.bom.required_header_items.quantity
                        ],
                        qr_path=qr_path,
                    )
                if self.export_drawing:
                    export.export_drawing(
                        filename=export_filename,
                        folder=Path(self.export_root_path, DRAWINGS),
                        document=part_document,
                        workspace=self.workspace,
                    )
                if self.export_stp:
                    export.export_stp(
                        filename=export_filename,
                        folder=Path(self.export_root_path, STPS),
                        document=part_document,
                    )
                if self.export_stl:
                    export.export_stl(
                        filename=export_filename,
                        folder=Path(self.export_root_path, STLS),
                        document=part_document,
                    )
                if self.export_jpg:
                    views = [
                        (view[0], view[1], view[2])
                        for view in resource.settings.export.jpg_views
                    ]
                    export.export_jpg(
                        filename=export_filename,
                        folder=Path(self.export_root_path, JPGS),
                        views=views,
                        bg=(1, 1, 1),
                    )

        elif &#34;.CATProduct&#34; in str(bom_item.path):
            with PyProductDocument() as product_document:
                product_document.open(bom_item.path)

                if self.export_docket:
                    export.export_docket(
                        docket_template=templates.docket_path,
                        filename=export_filename_with_project,
                        folder=Path(self.export_root_path, DOCKETS),
                        document=product_document,
                        config=self.docket_config,
                        project=bom_item.properties[
                            resource.bom.required_header_items.project
                        ],
                        quantity=bom_item.properties[
                            resource.bom.required_header_items.quantity
                        ],
                        logon=LOGON,
                        qr_path=qr_path,
                    )
                if self.export_documentation:
                    export.export_docket(
                        docket_template=templates.documentation_path,
                        filename=export_filename,
                        folder=Path(self.export_root_path, DOCUMENTATION),
                        document=product_document,
                        config=self.documentation_config,
                        project=bom_item.properties[
                            resource.bom.required_header_items.project
                        ],
                        machine=bom_item.properties[
                            resource.bom.required_header_items.machine
                        ],
                        partnumber=bom_item.properties[
                            resource.bom.required_header_items.partnumber
                        ],
                        revision=bom_item.properties[
                            resource.bom.required_header_items.revision
                        ],
                        quantity=bom_item.properties[
                            resource.bom.required_header_items.quantity
                        ],
                        qr_path=qr_path,
                    )
                if self.export_drawing:
                    export.export_drawing(
                        filename=export_filename,
                        folder=Path(self.export_root_path, DRAWINGS),
                        document=product_document,
                        workspace=self.workspace,
                    )
                if self.export_stp:
                    export.export_stp(
                        filename=export_filename,
                        folder=Path(self.export_root_path, STPS),
                        document=product_document,
                    )
                if self.export_jpg:
                    views = [
                        (view[0], view[1], view[2])
                        for view in resource.settings.export.jpg_views
                    ]
                    export.export_jpg(
                        filename=export_filename,
                        folder=Path(self.export_root_path, JPGS),
                        views=views,
                        bg=(1, 1, 1),
                    )

        else:
            raise PytiaWrongDocumentTypeError(
                f&#34;Failed exporting data: Document {str(bom_item.path)!r} is neither a part nor &#34;
                &#34;a product.&#34;
            )</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="pytia_bill_of_material.worker.export_items.ExportItemsTask"><code class="flex name class">
<span>class <span class="ident">ExportItemsTask</span></span>
<span>(</span><span>lazy_loader: helper.lazy_loaders.LazyDocumentHelper, runner: <a title="pytia_bill_of_material.worker.runner.Runner" href="runner.html#pytia_bill_of_material.worker.runner.Runner">Runner</a>, bom: models.bom.BOM, export_docket: bool, export_documentation: bool, export_drawing: bool, export_stp: bool, export_stl: bool, export_jpg: bool, export_root_path: pathlib.Path, docket_config: pytia.utilities.docket.DocketConfig, documentation_config: pytia.utilities.docket.DocketConfig, workspace: pytia_ui_tools.handlers.workspace_handler.Workspace)</span>
</code></dt>
<dd>
<div class="desc"><p>Exports all items:
- Dockets
- Docu Dockets
- Drawings
- STP
- STL</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>TaskProtocol</code></strong> :&ensp;<code>_type_</code></dt>
<dd>The protocol for the task runner.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>Exception</code></dt>
<dd>Raised when the keyword for 'source' is not in the BOM.</dd>
<dt><code>PytiaWrongDocumentTypeError</code></dt>
<dd>Raised when the document is neither a part nor a product.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>_type_</code></dt>
<dd><em>description</em></dd>
</dl>
<p>Inits the class.</p>
<h2 id="args_1">Args</h2>
<dl>
<dt><strong><code>lazy_loader</code></strong> :&ensp;<code>LazyDocumentHelper</code></dt>
<dd>The doc helper instance.</dd>
<dt><strong><code>runner</code></strong> :&ensp;<code>Runner</code></dt>
<dd>The task runner instance.</dd>
<dt><strong><code>bom</code></strong> :&ensp;<code>BOM</code></dt>
<dd>The BOM object.</dd>
<dt><strong><code>export_docket</code></strong> :&ensp;<code>bool</code></dt>
<dd>Wether to export the docket or not.</dd>
<dt><strong><code>export_documentation</code></strong> :&ensp;<code>bool</code></dt>
<dd>Wether to export the docu docket or not.</dd>
<dt><strong><code>export_drawing</code></strong> :&ensp;<code>bool</code></dt>
<dd>Wether to export the drawing or not.</dd>
<dt><strong><code>export_stp</code></strong> :&ensp;<code>bool</code></dt>
<dd>Wether to export the stp or not.</dd>
<dt><strong><code>export_stl</code></strong> :&ensp;<code>bool</code></dt>
<dd>Wether to export the stl or not.</dd>
<dt><strong><code>export_jpg</code></strong> :&ensp;<code>bool</code></dt>
<dd>Wether to export the jpg or not.</dd>
<dt><strong><code>export_root_path</code></strong> :&ensp;<code>Path</code></dt>
<dd>The root folder for all exports.</dd>
<dt><strong><code>docket_config</code></strong> :&ensp;<code>DocketConfig</code></dt>
<dd>The configuration for the docket.</dd>
<dt><strong><code>documentation_config</code></strong> :&ensp;<code>DocketConfig</code></dt>
<dd>The configuration for the docu docket.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class ExportItemsTask(TaskProtocol):
    &#34;&#34;&#34;
    Exports all items:
    - Dockets
    - Docu Dockets
    - Drawings
    - STP
    - STL

    Args:
        TaskProtocol (_type_): The protocol for the task runner.

    Raises:
        Exception: Raised when the keyword for &#39;source&#39; is not in the BOM.
        PytiaWrongDocumentTypeError: Raised when the document is neither a part nor a product.

    Returns:
        _type_: _description_
    &#34;&#34;&#34;

    def __init__(
        self,
        lazy_loader: LazyDocumentHelper,
        runner: Runner,
        bom: BOM,
        export_docket: bool,
        export_documentation: bool,
        export_drawing: bool,
        export_stp: bool,
        export_stl: bool,
        export_jpg: bool,
        export_root_path: Path,
        docket_config: DocketConfig,
        documentation_config: DocketConfig,
        workspace: Workspace,
    ) -&gt; None:
        &#34;&#34;&#34;
        Inits the class.

        Args:
            lazy_loader (LazyDocumentHelper): The doc helper instance.
            runner (Runner): The task runner instance.
            bom (BOM): The BOM object.
            export_docket (bool): Wether to export the docket or not.
            export_documentation (bool): Wether to export the docu docket or not.
            export_drawing (bool): Wether to export the drawing or not.
            export_stp (bool): Wether to export the stp or not.
            export_stl (bool): Wether to export the stl or not.
            export_jpg (bool): Wether to export the jpg or not.
            export_root_path (Path): The root folder for all exports.
            docket_config (DocketConfig): The configuration for the docket.
            documentation_config (DocketConfig): The configuration for the docu docket.
        &#34;&#34;&#34;
        self.lazy_loader = lazy_loader
        self.runner = runner
        self.bom = bom
        self.export_docket = export_docket
        self.export_documentation = export_documentation
        self.export_drawing = export_drawing
        self.export_stp = export_stp
        self.export_stl = export_stl
        self.export_jpg = export_jpg
        self.export_root_path = export_root_path
        self.docket_config = docket_config
        self.documentation_config = documentation_config
        self.workspace = workspace

    def run(self) -&gt; None:
        &#34;&#34;&#34;
        Runs the task.

        Raises:
            Exception: Raised when the keyword for &#39;source&#39; is not in the BOM.
        &#34;&#34;&#34;
        log.info(&#34;Exporting selected items.&#34;)
        if any(
            [
                self.export_docket,
                self.export_documentation,
                self.export_stp,
                self.export_stl,
                self.export_drawing,
                self.export_jpg,
            ]
        ):
            self.lazy_loader.close_all_documents()
            complete_items: Dict[PartnumberString, BOMAssemblyItem] = {}

            # The following &#39;solution&#39; is required to export all assemblies,
            # even those that don&#39;t show in the summary of the CATIA BOM.
            # It&#39;s not possible to only use all items of the bom.assemblies
            # object, because this would result in false quantities.
            # Therefor it&#39;s a must to compare those list object with great
            # care.
            for summary_item in self.bom.summary.items:
                complete_items[summary_item.partnumber] = summary_item

                for assembly in self.bom.assemblies:
                    for assembly_item in assembly.items:
                        if not assembly_item.partnumber in complete_items:
                            complete_items[assembly_item.partnumber] = assembly_item

            for partnumber, item in complete_items.items():
                if not resource.applied_keywords.source in item.properties:
                    raise Exception(
                        f&#34;Keyword {resource.applied_keywords.source!r} not in bill of material.&#34;
                    )
                if (
                    item.properties[resource.applied_keywords.source]
                    == resource.applied_keywords.made
                ):
                    self.runner.add(
                        func=self._export_item,
                        name=f&#34;Export item {partnumber!r}&#34;,
                        bom_item=item,
                    )

            self.runner.run_tasks()
            log.info(&#34;Finished item export.&#34;)
        else:
            log.info(&#34;Skipping item export: None selected.&#34;)

    def _generate_qr(self, bom_item: BOMAssemblyItem) -&gt; Path:
        &#34;&#34;&#34;
        Generates a qr jpg file and saves it to the temp directory. Returns the path.
        The QR ode contains a serialized json of: project, machine, partnumber and revision.

        Args:
            bom_item (BOMAssemblyItem): An item of the BOM object, from which data to generate the \
                qr code.

        Returns:
            Path: The path to the generated jpg file.
        &#34;&#34;&#34;
        project = bom_item.properties[resource.bom.required_header_items.project]
        machine = bom_item.properties[resource.bom.required_header_items.machine]
        partnumber = bom_item.properties[resource.bom.required_header_items.partnumber]
        revision = bom_item.properties[resource.bom.required_header_items.revision]

        qr = QR()
        qr_data = {
            &#34;project&#34;: project,
            &#34;machine&#34;: machine,
            &#34;partnumber&#34;: partnumber,
            &#34;revision&#34;: revision,
        }
        qr.generate(data=qr_data)
        qr_path = qr.save(
            path=Path(
                TEMP_EXPORT,
                self.export_root_path,
                file_utility.get_random_filename(filetype=&#34;png&#34;),
            )
        )
        file_utility.add_delete(path=qr_path, skip_silent=True)
        return qr_path

    def _export_item(self, bom_item: BOMAssemblyItem) -&gt; None:
        &#34;&#34;&#34;
        Exports the BOM item.

        TODO: Refactor this into smaller bits.

        Args:
            bom_item (BOMAssemblyItem): An item of the BOM object.

        Raises:
            PytiaWrongDocumentTypeError: Raised when the BOM item is neither a part nor a product.
        &#34;&#34;&#34;
        if bom_item.path is None:
            log.warning(
                f&#34;Skipped export of item {bom_item.partnumber!r}: Path of item not found.&#34;
            )
            return

        log.info(f&#34;Exporting data of item {bom_item.partnumber!r}.&#34;)
        export_filename = get_data_export_name(bom_item, with_project=False)
        export_filename_with_project = get_data_export_name(bom_item, with_project=True)
        qr_path = self._generate_qr(bom_item=bom_item)

        if &#34;.CATPart&#34; in str(bom_item.path):
            with PyPartDocument() as part_document:
                part_document.open(bom_item.path)

                if self.export_docket:
                    export.export_docket(
                        docket_template=templates.docket_path,
                        filename=export_filename_with_project,
                        folder=Path(self.export_root_path, DOCKETS),
                        document=part_document,
                        config=self.docket_config,
                        project=bom_item.properties[
                            resource.bom.required_header_items.project
                        ],
                        machine=bom_item.properties[
                            resource.bom.required_header_items.machine
                        ],
                        partnumber=bom_item.properties[
                            resource.bom.required_header_items.partnumber
                        ],
                        revision=bom_item.properties[
                            resource.bom.required_header_items.revision
                        ],
                        quantity=bom_item.properties[
                            resource.bom.required_header_items.quantity
                        ],
                        qr_path=qr_path,
                    )
                if self.export_documentation:
                    export.export_docket(
                        docket_template=templates.documentation_path,
                        filename=export_filename,
                        folder=Path(self.export_root_path, DOCUMENTATION),
                        document=part_document,
                        config=self.documentation_config,
                        project=bom_item.properties[
                            resource.bom.required_header_items.project
                        ],
                        machine=bom_item.properties[
                            resource.bom.required_header_items.machine
                        ],
                        partnumber=bom_item.properties[
                            resource.bom.required_header_items.partnumber
                        ],
                        revision=bom_item.properties[
                            resource.bom.required_header_items.revision
                        ],
                        quantity=bom_item.properties[
                            resource.bom.required_header_items.quantity
                        ],
                        qr_path=qr_path,
                    )
                if self.export_drawing:
                    export.export_drawing(
                        filename=export_filename,
                        folder=Path(self.export_root_path, DRAWINGS),
                        document=part_document,
                        workspace=self.workspace,
                    )
                if self.export_stp:
                    export.export_stp(
                        filename=export_filename,
                        folder=Path(self.export_root_path, STPS),
                        document=part_document,
                    )
                if self.export_stl:
                    export.export_stl(
                        filename=export_filename,
                        folder=Path(self.export_root_path, STLS),
                        document=part_document,
                    )
                if self.export_jpg:
                    views = [
                        (view[0], view[1], view[2])
                        for view in resource.settings.export.jpg_views
                    ]
                    export.export_jpg(
                        filename=export_filename,
                        folder=Path(self.export_root_path, JPGS),
                        views=views,
                        bg=(1, 1, 1),
                    )

        elif &#34;.CATProduct&#34; in str(bom_item.path):
            with PyProductDocument() as product_document:
                product_document.open(bom_item.path)

                if self.export_docket:
                    export.export_docket(
                        docket_template=templates.docket_path,
                        filename=export_filename_with_project,
                        folder=Path(self.export_root_path, DOCKETS),
                        document=product_document,
                        config=self.docket_config,
                        project=bom_item.properties[
                            resource.bom.required_header_items.project
                        ],
                        quantity=bom_item.properties[
                            resource.bom.required_header_items.quantity
                        ],
                        logon=LOGON,
                        qr_path=qr_path,
                    )
                if self.export_documentation:
                    export.export_docket(
                        docket_template=templates.documentation_path,
                        filename=export_filename,
                        folder=Path(self.export_root_path, DOCUMENTATION),
                        document=product_document,
                        config=self.documentation_config,
                        project=bom_item.properties[
                            resource.bom.required_header_items.project
                        ],
                        machine=bom_item.properties[
                            resource.bom.required_header_items.machine
                        ],
                        partnumber=bom_item.properties[
                            resource.bom.required_header_items.partnumber
                        ],
                        revision=bom_item.properties[
                            resource.bom.required_header_items.revision
                        ],
                        quantity=bom_item.properties[
                            resource.bom.required_header_items.quantity
                        ],
                        qr_path=qr_path,
                    )
                if self.export_drawing:
                    export.export_drawing(
                        filename=export_filename,
                        folder=Path(self.export_root_path, DRAWINGS),
                        document=product_document,
                        workspace=self.workspace,
                    )
                if self.export_stp:
                    export.export_stp(
                        filename=export_filename,
                        folder=Path(self.export_root_path, STPS),
                        document=product_document,
                    )
                if self.export_jpg:
                    views = [
                        (view[0], view[1], view[2])
                        for view in resource.settings.export.jpg_views
                    ]
                    export.export_jpg(
                        filename=export_filename,
                        folder=Path(self.export_root_path, JPGS),
                        views=views,
                        bg=(1, 1, 1),
                    )

        else:
            raise PytiaWrongDocumentTypeError(
                f&#34;Failed exporting data: Document {str(bom_item.path)!r} is neither a part nor &#34;
                &#34;a product.&#34;
            )</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>protocols.task_protocol.TaskProtocol</li>
<li>typing.Protocol</li>
<li>typing.Generic</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="pytia_bill_of_material.worker.export_items.ExportItemsTask.run"><code class="name flex">
<span>def <span class="ident">run</span></span>(<span>self) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Runs the task.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>Exception</code></dt>
<dd>Raised when the keyword for 'source' is not in the BOM.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def run(self) -&gt; None:
    &#34;&#34;&#34;
    Runs the task.

    Raises:
        Exception: Raised when the keyword for &#39;source&#39; is not in the BOM.
    &#34;&#34;&#34;
    log.info(&#34;Exporting selected items.&#34;)
    if any(
        [
            self.export_docket,
            self.export_documentation,
            self.export_stp,
            self.export_stl,
            self.export_drawing,
            self.export_jpg,
        ]
    ):
        self.lazy_loader.close_all_documents()
        complete_items: Dict[PartnumberString, BOMAssemblyItem] = {}

        # The following &#39;solution&#39; is required to export all assemblies,
        # even those that don&#39;t show in the summary of the CATIA BOM.
        # It&#39;s not possible to only use all items of the bom.assemblies
        # object, because this would result in false quantities.
        # Therefor it&#39;s a must to compare those list object with great
        # care.
        for summary_item in self.bom.summary.items:
            complete_items[summary_item.partnumber] = summary_item

            for assembly in self.bom.assemblies:
                for assembly_item in assembly.items:
                    if not assembly_item.partnumber in complete_items:
                        complete_items[assembly_item.partnumber] = assembly_item

        for partnumber, item in complete_items.items():
            if not resource.applied_keywords.source in item.properties:
                raise Exception(
                    f&#34;Keyword {resource.applied_keywords.source!r} not in bill of material.&#34;
                )
            if (
                item.properties[resource.applied_keywords.source]
                == resource.applied_keywords.made
            ):
                self.runner.add(
                    func=self._export_item,
                    name=f&#34;Export item {partnumber!r}&#34;,
                    bom_item=item,
                )

        self.runner.run_tasks()
        log.info(&#34;Finished item export.&#34;)
    else:
        log.info(&#34;Skipping item export: None selected.&#34;)</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pytia_bill_of_material.worker" href="index.html">pytia_bill_of_material.worker</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="pytia_bill_of_material.worker.export_items.ExportItemsTask" href="#pytia_bill_of_material.worker.export_items.ExportItemsTask">ExportItemsTask</a></code></h4>
<ul class="">
<li><code><a title="pytia_bill_of_material.worker.export_items.ExportItemsTask.run" href="#pytia_bill_of_material.worker.export_items.ExportItemsTask.run">run</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>