<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pytia_bill_of_material.utils.excel API documentation</title>
<meta name="description" content="Excel utility: Functions for handling Excel files." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pytia_bill_of_material.utils.excel</code></h1>
</header>
<section id="section-intro">
<p>Excel utility: Functions for handling Excel files.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
    Excel utility: Functions for handling Excel files.
&#34;&#34;&#34;

from typing import List

from helper.commons import ResourceCommons
from models.bom import BOMAssemblyItem
from openpyxl.styles import Alignment, Font, PatternFill
from openpyxl.worksheet._read_only import ReadOnlyWorksheet
from openpyxl.worksheet.worksheet import Worksheet
from pytia.exceptions import PytiaDispatchError, PytiaNotInstalledError
from pytia.log import log
from resources import resource
from win32com.client import CDispatch, Dispatch
from win32com.client.gencache import EnsureDispatch
from win32com.server.exception import COMException


def get_excel() -&gt; CDispatch:
    &#34;&#34;&#34;
    Returns the EXCEL com object.

    Raises:
        PytiaNotInstalledError: Raised when MS Excel is not installed.
        PytiaDispatchError: Raises when the connection to the Excel com host fails.

    Returns:
        CDispatch: The Excel com object.
    &#34;&#34;&#34;
    try:
        # app = EnsureDispatch(&#34;EXCEL.Application&#34;)
        app = Dispatch(&#34;EXCEL.Application&#34;)
        return app  # type: ignore
    except COMException as e:
        raise PytiaNotInstalledError(
            f&#34;Excel is not installed on this system: {e}&#34;
        ) from e
    except Exception as e:  # pylint: disable=broad-except
        raise PytiaDispatchError(f&#34;Failed connecting to Excel: {e}&#34;) from e


def create_header(worksheet: Worksheet, header_items: list) -&gt; None:
    &#34;&#34;&#34;
    Creates a header row in the given worksheet.

    Args:
        worksheet (Worksheet): The worksheet into which to create the header row.
        header_items (tuple): The header items to create (the bom.json list).
    &#34;&#34;&#34;
    items = ResourceCommons.get_header_names_from_config(header_items)

    if isinstance(resource.bom.header_row, int):
        for index, item in enumerate(items):
            worksheet.cell(resource.bom.header_row + 1, index + 1, str(item))
        log.info(f&#34;Created header for worksheet {worksheet.title!r}&#34;)
    else:
        log.info(f&#34;Skipped creating header for worksheet {worksheet.title!r}.&#34;)


def write_data(
    worksheet: Worksheet, header_items: list, data: List[BOMAssemblyItem], strict: bool
) -&gt; None:
    &#34;&#34;&#34;
    Writes the properties from the given data object to the given worksheet.
    Takes care that each datum will be written to the corresponding header.

    Args:
        worksheet (Worksheet): The worksheet to add the data to.
        header_items (tuple): The header items (the bom.json list).
        data (List[BOMAssemblyItem]): The actual data.
        strict (bool): If set to True, an error will be raised if the properties are \
            not in the header items.
    &#34;&#34;&#34;
    items = ResourceCommons.get_property_names_from_config(header_items)

    for ri, rv in enumerate(data):
        for ci, cv in enumerate(items):
            if cv in rv.properties:
                cell_value = rv.properties[cv]
            elif strict:
                raise KeyError(f&#34;Did not find property {cv!r} in data.&#34;)
            else:
                cell_value = None
                # log.warning(
                #     f&#34;Did not find property {cv!r} in data (is this header missing in &#34;
                #     &#34;the header_items.summary list of the bom.json config file?&#34;
                # )
            worksheet.cell(
                row=ri + resource.bom.data_row + 1, column=ci + 1
            ).value = cell_value
    log.info(f&#34;Wrote all data to worksheet {worksheet.title!r}.&#34;)


def row_is_empty(worksheet: Worksheet | ReadOnlyWorksheet, row: int) -&gt; bool:
    &#34;&#34;&#34;Returns wether the given row is empty or not.&#34;&#34;&#34;
    return all(
        [
            worksheet.cell(row, i).value is None
            for i in range(1, worksheet.max_column + 1)
        ]
    )


def style_worksheet(worksheet: Worksheet) -&gt; None:
    &#34;&#34;&#34;Styles the worksheet as stated in the bom.json config file.&#34;&#34;&#34;
    for column_cells in worksheet.columns:
        # Set format, font and size
        for index, cell in enumerate(column_cells):
            if index &gt; resource.bom.data_row - 1:
                color = (
                    resource.bom.data_color_1
                    if index % 2 == 0
                    else resource.bom.data_color_2
                )
                bg_color = (
                    resource.bom.data_bg_color_1
                    if index % 2 == 0
                    else resource.bom.data_bg_color_2
                )
                cell.fill = PatternFill(
                    start_color=bg_color, end_color=bg_color, fill_type=&#34;solid&#34;
                )
            else:
                color = None
            cell.number_format = &#34;@&#34;
            cell.font = Font(
                name=resource.bom.font, size=resource.bom.size, color=color
            )
            cell.alignment = Alignment(horizontal=&#34;left&#34;, vertical=&#34;center&#34;)

        # Set font and height for the header row
        if isinstance(resource.bom.header_row, int):
            worksheet.row_dimensions[resource.bom.header_row + 1].height = 20  # type: ignore
            column_cells[resource.bom.header_row].font = Font(
                name=resource.bom.font,
                size=resource.bom.size,
                bold=True,
                color=resource.bom.header_color,
            )
            column_cells[resource.bom.header_row].fill = PatternFill(
                start_color=resource.bom.header_bg_color,
                end_color=resource.bom.header_bg_color,
                fill_type=&#34;solid&#34;,
            )
            column_cells[resource.bom.header_row].alignment = Alignment(
                horizontal=&#34;center&#34;, vertical=&#34;center&#34;
            )

        # Set cell width
        length = max(len(str(cell.value)) * 1.1 for cell in column_cells)
        worksheet.column_dimensions[column_cells[0].column_letter].width = (  # type: ignore
            length if length &gt; 2 else 2
        )

    log.info(f&#34;Styled worksheet {worksheet.title!r}.&#34;)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pytia_bill_of_material.utils.excel.create_header"><code class="name flex">
<span>def <span class="ident">create_header</span></span>(<span>worksheet: openpyxl.worksheet.worksheet.Worksheet, header_items: list) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Creates a header row in the given worksheet.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>worksheet</code></strong> :&ensp;<code>Worksheet</code></dt>
<dd>The worksheet into which to create the header row.</dd>
<dt><strong><code>header_items</code></strong> :&ensp;<code>tuple</code></dt>
<dd>The header items to create (the bom.json list).</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def create_header(worksheet: Worksheet, header_items: list) -&gt; None:
    &#34;&#34;&#34;
    Creates a header row in the given worksheet.

    Args:
        worksheet (Worksheet): The worksheet into which to create the header row.
        header_items (tuple): The header items to create (the bom.json list).
    &#34;&#34;&#34;
    items = ResourceCommons.get_header_names_from_config(header_items)

    if isinstance(resource.bom.header_row, int):
        for index, item in enumerate(items):
            worksheet.cell(resource.bom.header_row + 1, index + 1, str(item))
        log.info(f&#34;Created header for worksheet {worksheet.title!r}&#34;)
    else:
        log.info(f&#34;Skipped creating header for worksheet {worksheet.title!r}.&#34;)</code></pre>
</details>
</dd>
<dt id="pytia_bill_of_material.utils.excel.get_excel"><code class="name flex">
<span>def <span class="ident">get_excel</span></span>(<span>) ‑> win32com.client.CDispatch</span>
</code></dt>
<dd>
<div class="desc"><p>Returns the EXCEL com object.</p>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>PytiaNotInstalledError</code></dt>
<dd>Raised when MS Excel is not installed.</dd>
<dt><code>PytiaDispatchError</code></dt>
<dd>Raises when the connection to the Excel com host fails.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>CDispatch</code></dt>
<dd>The Excel com object.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_excel() -&gt; CDispatch:
    &#34;&#34;&#34;
    Returns the EXCEL com object.

    Raises:
        PytiaNotInstalledError: Raised when MS Excel is not installed.
        PytiaDispatchError: Raises when the connection to the Excel com host fails.

    Returns:
        CDispatch: The Excel com object.
    &#34;&#34;&#34;
    try:
        # app = EnsureDispatch(&#34;EXCEL.Application&#34;)
        app = Dispatch(&#34;EXCEL.Application&#34;)
        return app  # type: ignore
    except COMException as e:
        raise PytiaNotInstalledError(
            f&#34;Excel is not installed on this system: {e}&#34;
        ) from e
    except Exception as e:  # pylint: disable=broad-except
        raise PytiaDispatchError(f&#34;Failed connecting to Excel: {e}&#34;) from e</code></pre>
</details>
</dd>
<dt id="pytia_bill_of_material.utils.excel.row_is_empty"><code class="name flex">
<span>def <span class="ident">row_is_empty</span></span>(<span>worksheet: openpyxl.worksheet.worksheet.Worksheet | openpyxl.worksheet._read_only.ReadOnlyWorksheet, row: int) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>Returns wether the given row is empty or not.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def row_is_empty(worksheet: Worksheet | ReadOnlyWorksheet, row: int) -&gt; bool:
    &#34;&#34;&#34;Returns wether the given row is empty or not.&#34;&#34;&#34;
    return all(
        [
            worksheet.cell(row, i).value is None
            for i in range(1, worksheet.max_column + 1)
        ]
    )</code></pre>
</details>
</dd>
<dt id="pytia_bill_of_material.utils.excel.style_worksheet"><code class="name flex">
<span>def <span class="ident">style_worksheet</span></span>(<span>worksheet: openpyxl.worksheet.worksheet.Worksheet) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Styles the worksheet as stated in the bom.json config file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def style_worksheet(worksheet: Worksheet) -&gt; None:
    &#34;&#34;&#34;Styles the worksheet as stated in the bom.json config file.&#34;&#34;&#34;
    for column_cells in worksheet.columns:
        # Set format, font and size
        for index, cell in enumerate(column_cells):
            if index &gt; resource.bom.data_row - 1:
                color = (
                    resource.bom.data_color_1
                    if index % 2 == 0
                    else resource.bom.data_color_2
                )
                bg_color = (
                    resource.bom.data_bg_color_1
                    if index % 2 == 0
                    else resource.bom.data_bg_color_2
                )
                cell.fill = PatternFill(
                    start_color=bg_color, end_color=bg_color, fill_type=&#34;solid&#34;
                )
            else:
                color = None
            cell.number_format = &#34;@&#34;
            cell.font = Font(
                name=resource.bom.font, size=resource.bom.size, color=color
            )
            cell.alignment = Alignment(horizontal=&#34;left&#34;, vertical=&#34;center&#34;)

        # Set font and height for the header row
        if isinstance(resource.bom.header_row, int):
            worksheet.row_dimensions[resource.bom.header_row + 1].height = 20  # type: ignore
            column_cells[resource.bom.header_row].font = Font(
                name=resource.bom.font,
                size=resource.bom.size,
                bold=True,
                color=resource.bom.header_color,
            )
            column_cells[resource.bom.header_row].fill = PatternFill(
                start_color=resource.bom.header_bg_color,
                end_color=resource.bom.header_bg_color,
                fill_type=&#34;solid&#34;,
            )
            column_cells[resource.bom.header_row].alignment = Alignment(
                horizontal=&#34;center&#34;, vertical=&#34;center&#34;
            )

        # Set cell width
        length = max(len(str(cell.value)) * 1.1 for cell in column_cells)
        worksheet.column_dimensions[column_cells[0].column_letter].width = (  # type: ignore
            length if length &gt; 2 else 2
        )

    log.info(f&#34;Styled worksheet {worksheet.title!r}.&#34;)</code></pre>
</details>
</dd>
<dt id="pytia_bill_of_material.utils.excel.write_data"><code class="name flex">
<span>def <span class="ident">write_data</span></span>(<span>worksheet: openpyxl.worksheet.worksheet.Worksheet, header_items: list, data: List[models.bom.BOMAssemblyItem], strict: bool) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Writes the properties from the given data object to the given worksheet.
Takes care that each datum will be written to the corresponding header.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>worksheet</code></strong> :&ensp;<code>Worksheet</code></dt>
<dd>The worksheet to add the data to.</dd>
<dt><strong><code>header_items</code></strong> :&ensp;<code>tuple</code></dt>
<dd>The header items (the bom.json list).</dd>
<dt><strong><code>data</code></strong> :&ensp;<code>List[BOMAssemblyItem]</code></dt>
<dd>The actual data.</dd>
<dt><strong><code>strict</code></strong> :&ensp;<code>bool</code></dt>
<dd>If set to True, an error will be raised if the properties are
not in the header items.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def write_data(
    worksheet: Worksheet, header_items: list, data: List[BOMAssemblyItem], strict: bool
) -&gt; None:
    &#34;&#34;&#34;
    Writes the properties from the given data object to the given worksheet.
    Takes care that each datum will be written to the corresponding header.

    Args:
        worksheet (Worksheet): The worksheet to add the data to.
        header_items (tuple): The header items (the bom.json list).
        data (List[BOMAssemblyItem]): The actual data.
        strict (bool): If set to True, an error will be raised if the properties are \
            not in the header items.
    &#34;&#34;&#34;
    items = ResourceCommons.get_property_names_from_config(header_items)

    for ri, rv in enumerate(data):
        for ci, cv in enumerate(items):
            if cv in rv.properties:
                cell_value = rv.properties[cv]
            elif strict:
                raise KeyError(f&#34;Did not find property {cv!r} in data.&#34;)
            else:
                cell_value = None
                # log.warning(
                #     f&#34;Did not find property {cv!r} in data (is this header missing in &#34;
                #     &#34;the header_items.summary list of the bom.json config file?&#34;
                # )
            worksheet.cell(
                row=ri + resource.bom.data_row + 1, column=ci + 1
            ).value = cell_value
    log.info(f&#34;Wrote all data to worksheet {worksheet.title!r}.&#34;)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pytia_bill_of_material.utils" href="index.html">pytia_bill_of_material.utils</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pytia_bill_of_material.utils.excel.create_header" href="#pytia_bill_of_material.utils.excel.create_header">create_header</a></code></li>
<li><code><a title="pytia_bill_of_material.utils.excel.get_excel" href="#pytia_bill_of_material.utils.excel.get_excel">get_excel</a></code></li>
<li><code><a title="pytia_bill_of_material.utils.excel.row_is_empty" href="#pytia_bill_of_material.utils.excel.row_is_empty">row_is_empty</a></code></li>
<li><code><a title="pytia_bill_of_material.utils.excel.style_worksheet" href="#pytia_bill_of_material.utils.excel.style_worksheet">style_worksheet</a></code></li>
<li><code><a title="pytia_bill_of_material.utils.excel.write_data" href="#pytia_bill_of_material.utils.excel.write_data">write_data</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>